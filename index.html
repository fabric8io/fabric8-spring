<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.3">
<title>Fabric8 Spring</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Fabric8 Spring</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#make-jar-not-war-we-need-moar">1.1. Make JAR not WAR. We need Moar!</a></li>
<li><a href="#isn-t-docker-and-kubernetes-complicated">1.2. Isn&#8217;t Docker and Kubernetes complicated?</a></li>
<li><a href="#how-easy-is-it">1.3. How easy is it?</a></li>
<li><a href="#do-i-need-to-do-anything-different-for-my-spring-boot-app">1.4. Do I need to do anything different for my Spring Boot app?</a></li>
</ul>
</li>
<li><a href="#create-your-spring-boot-app">2. Create your Spring Boot application</a>
<ul class="sectlevel2">
<li><a href="#spring-initializr-or-existing-spring-projects">2.1. Spring Initializr or existing Spring projects</a></li>
<li><a href="#jboss-developer-studio">2.2. JBoss Developer Studio</a></li>
<li><a href="#intellij">2.3. IntelliJ</a></li>
<li><a href="#spring-boot-on-kubernetes">2.4. Spring Boot on Kubernetes</a></li>
<li><a href="#openshif-s2i-binary-builds">2.5. OpenShif s2i binary builds</a></li>
<li><a href="#continuous-delivery">2.6. Continuous Delivery</a></li>
</ul>
</li>
<li><a href="#create-microservice-via-console">3. Create a microservice via the console</a>
<ul class="sectlevel3">
<li><a href="#runtime-tabs">3.1. Runtime tabs</a></li>
<li><a href="#demo">3.2. Demo</a></li>
</ul>
</li>
<li><a href="#elasticity">4. Elasticity and Resilience</a>
<ul class="sectlevel2">
<li><a href="#operator-based-scaling">4.1. Operator-based scaling</a></li>
<li><a href="#autoscaling">4.2. Autoscaling</a></li>
</ul>
</li>
<li><a href="#service-discovery">5. Service Discovery</a>
<ul class="sectlevel2">
<li><a href="#kubernetes-service-discovery">5.1. Kubernetes Service Discovery</a></li>
</ul>
</li>
<li><a href="#load-balancing">6. Load Balancing</a></li>
<li><a href="#design-for-failure">7. Design for failure</a>
<ul class="sectlevel3">
<li><a href="#maximize-service-availability">7.1. Maximize service availability</a></li>
<li><a href="#self-healing">7.2. Self healing</a></li>
<li><a href="#isolate-blast-radius-of-failures">7.3. Isolate blast radius of failures</a></li>
<li><a href="#prove-your-system-has-been-designed-for-failure">7.4. Prove your system has been designed for failure</a></li>
</ul>
</li>
<li><a href="#configuration">8. Configuration</a>
<ul class="sectlevel3">
<li><a href="#include-configuration-inside-the-docker-image">8.1. Include configuration inside the docker image</a></li>
<li><a href="#configmap">8.2. ConfigMap</a></li>
<li><a href="#git">8.3. Git</a></li>
<li><a href="#choosing-the-right-approach">8.4. Choosing the right approach</a></li>
</ul>
</li>
<li><a href="#pipelines">9. Pipelines</a></li>
<li><a href="#logging">10. Logging</a></li>
<li><a href="#monitoring">11. Monitoring</a></li>
<li><a href="#circuit-breakers">12. Circuit Breakers</a>
<ul class="sectlevel2">
<li><a href="#a-href-spring-cloud-netflix-spring-cloud-netflix-a">12.1. <a href="#spring-cloud-netflix">Spring Cloud - Netflix</a></a></li>
<li><a href="#standalone-applications">12.2. Standalone applications</a></li>
<li><a href="#kubeflix">12.3. Kubeflix</a></li>
<li><a href="#wildfly-swarm-netflix">12.4. Wildfly Swarm Netflix</a></li>
</ul>
</li>
<li><a href="#tracing">13. Tracing</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>&#169; 2016 The original authors.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect1">
<h2 id="introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document will help you get started building applications with Spring Boot that run on Kubernetes and various distributions of Kubernetes (ie, OpenShift v3.x).</p>
</div>
<div class="sect2">
<h3 id="make-jar-not-war-we-need-moar">1.1. Make JAR not WAR. We need Moar!</h3>
<div class="paragraph">
<p>Spring Boot is a great way to build simple Java microservices and has a vibrant ecosystem to help facilitate. Spring Boot and its surrounding ecosystem go to great lengths to help developers get started with microservices including taking some of the pain out of configuration, health checking, boostrapping etc. For example, Spring Boot prefers an "uber-jar" model of packaging a microservice which is executable on its own. This helps reduce the many mistakes that can happen when trying to juggle application servers + WARs/EARs as well as simplifies the classloading model for those apps that can get away with it. When we&#8217;re deploying lots of microservices, we want to eliminate configuration drift as much as possible and reason about our apps without adding complications between environments.</p>
</div>
<div class="paragraph">
<p>Building to uber jars does help with this but is not the end of the story. As we further our quest to reduce configuration drift between environments for our apps we must also be aware of this fact: A Java based microservice depends fully on a JVM. The JVM <em>is</em> a very important implementation detail of our Java application. As are the dependencies and transitive dependencies of the JVM (libc, etc). A developer that created an app using a particular JVM on, let&#8217;s say, Windows could potentially behave quite differently on a different JVM running on Linux (in a QA environment, let&#8217;s say). You&#8217;ll want a way to capture the complete snapshot of binaries that make up you application and Linux Containers and associated image formats is a great way to do that.</p>
</div>
</div>
<div class="sect2">
<h3 id="isn-t-docker-and-kubernetes-complicated">1.2. Isn&#8217;t Docker and Kubernetes complicated?</h3>
<div class="paragraph">
<p>There&#8217;s an interesting dynamic between "yah we need this" and "well, it&#8217;s too complicated". We can hope and pray and ignore it? But really, what if we just made it easier to build your Docker images and deploy to Kubernetes? That&#8217;s what the fabric8 tooling does for you. It allows you to just use the same developer tools you use today and take advantage of building and deploying cloud-native applications on Kubernetes.</p>
</div>
</div>
<div class="sect2">
<h3 id="how-easy-is-it">1.3. How easy is it?</h3>
<div class="paragraph">
<p>Lots of Java developers are used to using application servers, creating deployment units (jars/wars), deploying them and running them in app servers using Maven. Then they can use Maven from the command line or easily inside their IDE to do most of the work.</p>
</div>
<div class="paragraph">
<p>So we figured, why not make Kubernetes look and feel like an application server to a Java developer? So you build and deploy your application from maven like you would with other maven plugins like spring-boot, tomcat, jetty, wildfly, karaf et al. Then you can get started quickly by just treating Kubernetes as a kind of application server.</p>
</div>
<div class="paragraph">
<p>Kubernetes is actually way more awesome than an application server; its more like an application cloud as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>kubernetes can keep running multiple instances of each of your apps including automatic restarts on software or hardware failures</p>
</li>
<li>
<p>automatic load balancing when invoking your apps</p>
</li>
<li>
<p>each app instance is isolated as a separate process so its much easier to monitor metrics and logs</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Keep reading to get started with Spring Boot, or checkout <a href="http://maven.fabric8.io">how we&#8217;ve made it easy for tomcat, jetty, wildfly, karaf, standalone, etc too!</a></p>
</div>
</div>
<div class="sect2">
<h3 id="do-i-need-to-do-anything-different-for-my-spring-boot-app">1.4. Do I need to do anything different for my Spring Boot app?</h3>
<div class="paragraph">
<p>No! Just create your Spring Boot app (or use an existing one if you&#8217;ve got one) and add a single maven plugin. That&#8217;s it! Here&#8217;s how we get started.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="create-your-spring-boot-app">2. Create your Spring Boot application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Go to <a href="http://start.spring.io">http://start.spring.io</a> and create your app. That&#8217;s it. You have other options too:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>With Spring Tool Suite (STS)</p>
</li>
<li>
<p>with Spring Initializr CLI</p>
</li>
<li>
<p>With JBoss Developer Studio (see below)</p>
</li>
<li>
<p>With IntelliJ, Eclipse, Netbeans (via JBoss Forge â€“ see below)</p>
</li>
<li>
<p>With the Fabric8 console for CI/CD</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We can also do with these, but will be covered in a different section:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>With JBoss Forge CLI</p>
</li>
<li>
<p>With maven archetypes/fabric8 quickstarts</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="spring-initializr-or-existing-spring-projects">2.1. Spring Initializr or existing Spring projects</h3>
<div class="paragraph">
<p>STS, start.spring.io, and the spring-boot CLI all use Spring Initializr under the covers.</p>
</div>
<div class="paragraph">
<p>To kubernetes enable your Spring project, you will need to enable the <a href="http://maven.fabric8.io/">fabric8 maven plugin</a>.</p>
</div>
<div class="paragraph">
<p>The simplest way to do this is by using the <a href="https://maven.fabric8.io/#fabric8:setup">fabric8:setup</a> goal from the maven plugin; this will add the necessary maven plugin configuration to your <code>pom.xml</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">mvn io.fabric8:fabric8-maven-plugin:3.1.32:setup</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or you can manually add the following section to your <code>pom.xml</code> by hand:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;build&gt;</span>
  ...
     <span class="tag">&lt;plugins&gt;</span>
       <span class="tag">&lt;plugin&gt;</span>
       <span class="tag">&lt;groupId&gt;</span>io.fabric8<span class="tag">&lt;/groupId&gt;</span>
       <span class="tag">&lt;artifactId&gt;</span>fabric8-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
       <span class="tag">&lt;version&gt;</span>3.1.32<span class="tag">&lt;/version&gt;</span>
       <span class="tag">&lt;executions&gt;</span>
         <span class="tag">&lt;execution&gt;</span>
           <span class="tag">&lt;goals&gt;</span>
             <span class="tag">&lt;goal&gt;</span>resource<span class="tag">&lt;/goal&gt;</span>
             <span class="tag">&lt;goal&gt;</span>helm<span class="tag">&lt;/goal&gt;</span>
             <span class="tag">&lt;goal&gt;</span>build<span class="tag">&lt;/goal&gt;</span>
           <span class="tag">&lt;/goals&gt;</span>
         <span class="tag">&lt;/execution&gt;</span>
       <span class="tag">&lt;/executions&gt;</span>
       <span class="tag">&lt;/plugin&gt;</span>
  ...</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jboss-developer-studio">2.2. JBoss Developer Studio</h3>
<div class="paragraph">
<p>JBoss Developer Studio has JBoss Forge tooling installed by default. Press <code>CTRL+4</code> or <code>CMD+4</code> if on Mac to get the forge window. If you haven&#8217;t already, install the Fabric8 <code>devops</code> plugin which will enable the Spring Boot project wizards. You can install the addon from within JBDS by hitting <code>CTRL/CMD+4</code> and type <code>addon</code> and find the option for installing. Use the coordinate below:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/addon-install.png" alt="addon install"></span></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>addon-install --coordinate io.fabric8.forge:devops,2.3.18</code></pre>
</div>
</div>
<div class="paragraph">
<p>The forge tooling is great because it allows you to declaratively add components/code to your project (kind of like <a href="https://www.atomist.com">atomist</a>) and we recommend it. However, you could just use the <code>fabric8:setup</code> goal as we did above from within your IDE as well.</p>
</div>
<div class="paragraph">
<p>Now when you <code>CTRL/CMD+4</code> you can type <code>project</code> and select the <code>Project New</code> option. When you begin creating the new project, fill in the Project Name, Package Name, etc. and make sure to change the Project Type to 'spring boot':</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/spring-boot-project-new.png" alt="spring boot"></span></p>
</div>
<div class="paragraph">
<p>When you click "Next", you can choose the dependencies you like for your project (just as you can from any Spring Initializr dialog including start.spring.io).</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/spring-boot-choose-deps.png" alt="spring boot"></span></p>
</div>
<div class="paragraph">
<p>Clicking "Finish" will create the project for you. At this point you have a skeleton Spring Boot project into which you can add your own amazing business logic.</p>
</div>
<div class="paragraph">
<p>What about when you&#8217;re ready to start using the Fabric8 tooling and build Docker images for your Kubernetes installation?</p>
</div>
<div class="paragraph">
<p>Select the project in your project/package explorer and then hit <code>CTLR/CMD+4</code> and type <code>fabric8</code> into the dialog box filter. You should see an option for <em>Fabric8 Setup</em>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/fabric8-setup-eclipse.png" alt="fabric8 setup"></span></p>
</div>
<div class="paragraph">
<p>When the next dialog box comes up you can add metadata about which Docker image to use or which Main class to bootstrap, but in our case the fabric8 tooling is going to pick sensible defaults since it will auto-detect we have a Spring Boot application. Just click "Finish"</p>
</div>
<div class="paragraph">
<p>Now if we take a look at the pom.xml, we&#8217;ll see that our <code>fabric8-maven-plugin</code> has been added:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/f-m-p-added.png" alt="fabric8 setup"></span></p>
</div>
<div class="paragraph">
<p>You&#8217;re now in business! Skip to the section titled "Spring Boot on Kubernetes" if you&#8217;re not interested in set up for IntelliJ. Or, watch a video of doing this whole process here:</p>
</div>
<div class="paragraph">
<p>&lt;iframe src="https://player.vimeo.com/video/180053437" width="640" height="360" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen&gt;&lt;/iframe&gt;
&lt;p&gt;&lt;a href="https://vimeo.com/180053437"&gt;Spring Boot, Spring Cloud with Kubernetes and Fabric8&lt;/a&gt; from &lt;a href="https://vimeo.com/ceposta"&gt;Christian Posta&lt;/a&gt; on &lt;a href="https://vimeo.com"&gt;Vimeo&lt;/a&gt;.&lt;/p&gt;</p>
</div>
</div>
<div class="sect2">
<h3 id="intellij">2.3. IntelliJ</h3>
<div class="paragraph">
<p>JBoss Forge doesn&#8217;t come out of the box with IntelliJ but through IntelliJ&#8217;s amazing plugin system, we can easily added it! Just note, you should be running IntelliJ with JDK 1.8+. Newer versions of IntelliJ bundle and use JDK 1.8 out of the box. If you&#8217;ve an older version of IntelliJ, hit <code>CMD/CTRL+SHIFT+A</code> to get the <code>All Actions</code> dialog box and start typing <code>SDK</code>. Follow the instructions to change the SDK.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/intellij-change-sdk.png" alt="SDK IntelliJ"></span></p>
</div>
<div class="paragraph">
<p>Now you can go to the plugins dialog box and find JBoss Forge:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/intellij-install-forge.png" alt="IntelliJ install Forge"></span></p>
</div>
<div class="paragraph">
<p>Now you can <code>CTRL+ALT+4</code> or <code>CMD+OPTION+4</code> on Mac to get the Forge dialog box:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/intellij-run-forge-command.png" alt="intellij run forge"></span></p>
</div>
<div class="paragraph">
<p>Just like with the JBDS example, we&#8217;ll find the "Project New" option, fill in the project information, and make sure to select Project Type of Spring Boot:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/intellij-new-project.png" alt="intellij new project"></span>.</p>
</div>
<div class="paragraph">
<p>Click next, select the Spring Boot dependencies you&#8217;d like to include in your project and click Finish.</p>
</div>
<div class="paragraph">
<p>To add the Fabric8 tooling, select the root of your project and go back to the Forge dialog (<code>CMD/CTRL+ALT/OPTION+4</code>) and begin typing fabric8</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/intellij-fabric8-setup.png" alt="intellij fabric8 setup"></span></p>
</div>
<div class="paragraph">
<p>Again, you can add more details to the setup, but just clicking "Finish" is sufficient because fabric8 can auto-detect we&#8217;re in a Spring Boot project and use appropriate defaults. Now if you open the <code>pom.xml</code> you&#8217;ll see the <code>fabric8-maven-plugin</code> added:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/intellij-f-m-p-added.png" alt="intellij fmp added"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="spring-boot-on-kubernetes">2.4. Spring Boot on Kubernetes</h3>
<div class="paragraph">
<p>Once we have our Spring Boot microservice to our liking we want to be able to package it up and deliver it to our cluster running in the Cloud. Docker provides a great abstraction (the container!) for doing this. To be able to do this while running on Mac OS X or Windows, we&#8217;ll need a little help. We&#8217;ll need a Docker daemon and Kubernetes to do this. Here are a few options for getting started:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/kubernetes/minikube">minikube</a></p>
</li>
<li>
<p><a href="https://github.com/jimmidyson/minishift">minishift</a></p>
</li>
<li>
<p><a href="https://trello.com/c/HTSNnyjV/891-13-add-oc-cluster-up-command-to-bootstrap-a-cluster-evg">oc cluster up</a></p>
</li>
<li>
<p><a href="http://developers.redhat.com/products/cdk/overview/">Red Hat Container Development Kit</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the fabric8 docs (<a href="http://fabric8.io/guide/index.html">http://fabric8.io/guide/index.html</a>) for more details.</p>
</div>
<div class="paragraph">
<p>Once we have a Docker/Kubernetes environment up and have access to a Docker daemon we can build our docker images. For OpenShift users that wish to use Source to Image, see the next section. First let&#8217;s verify we have docker connected properly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>$ docker images</code></pre>
</div>
</div>
<div class="paragraph">
<p>If that command returns a list of docker images, you&#8217;re ready to go.</p>
</div>
<div class="paragraph">
<p>Also make sure you&#8217;re logged into Kubernetes properly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>$ kubectl get nodes</code></pre>
</div>
</div>
<div class="paragraph">
<p>If that command returns a list of nodes (just 1 if running locally) then you&#8217;re good!</p>
</div>
<div class="paragraph">
<p>Navigate to your spring boot application that we created earlier (and also to which we added the <code>fabric8-maven-plugin</code>). Try running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>$ mvn clean install</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you run a <code>docker images</code> now you should see our new Docker image built and ready to go!!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>$ docker images
REPOSITORY                                   TAG                 IMAGE ID            CREATED             SIZE
demo/ipservice                               latest              b491738bf223        35 seconds ago      161.5 MB
example/foo                                  1.0.1               f86db95465cf        About an hour ago   161.5 MB
172.30.128.90:80/example/foo                 1.0.1               f86db95465cf        About an hour ago   161.5 MB
foo/foo                                      latest              aa5fa39e3609        21 hours ago        161.5 MB</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s pretty amazing. Didn&#8217;t have to touch a Dockerfile or anything.</p>
</div>
<div class="paragraph">
<p>What about deploying to Kubernetes? To do that, we usually have to build a Kuberentes resource <code>yml</code> file. Take a look at the <code>./target/classes/META-INF/fabric8</code> folder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>$ ls -l ./target/classes/META-INF/fabric8/
total 32
drwxr-xr-x  4 ceposta  staff   136 Sep  2 14:07 kubernetes
-rw-r--r--  1 ceposta  staff  3226 Sep  2 14:07 kubernetes.json
-rw-r--r--  1 ceposta  staff  2344 Sep  2 14:07 kubernetes.yml
drwxr-xr-x  4 ceposta  staff   136 Sep  2 14:07 openshift
-rw-r--r--  1 ceposta  staff  3343 Sep  2 14:07 openshift.json
-rw-r--r--  1 ceposta  staff  2415 Sep  2 14:07 openshift.yml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Woah! The maven plugin generated manifest json/yml files for us! Let&#8217;s take a quick look:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>$ cat ./target/classes/META-INF/fabric8/kubernetes.yml
---
apiVersion: "v1"
kind: "List"
items:
- apiVersion: "v1"
  kind: "Service"
  metadata:
    annotations:
      prometheus.io/port: "9779"
      prometheus.io/scrape: "true"
      fabric8.io/iconUrl: "img/icons/spring-boot.svg"
    labels:
      provider: "fabric8"
      project: "ipservice"
      version: "1.0.0-SNAPSHOT"
      group: "com.redhat.demo"
    name: "ipservice"
  spec:
    ports:
    - port: 8080
      protocol: "TCP"
      targetPort: 8080
    selector:
      project: "ipservice"
      provider: "fabric8"
      group: "com.redhat.demo"
    type: "LoadBalancer"
- apiVersion: "extensions/v1beta1"
  kind: "Deployment"
  metadata:
    annotations:
      fabric8.io/iconUrl: "img/icons/spring-boot.svg"
      fabric8.io/metrics-path: "dashboard/file/kubernetes-pods.json/?var-project=ipservice&amp;var-version=1.0.0-SNAPSHOT"
    labels:
      provider: "fabric8"
      project: "ipservice"
      version: "1.0.0-SNAPSHOT"
      group: "com.redhat.demo"
    name: "ipservice"
  spec:
    replicas: 1
    selector:
      matchLabels:
        project: "ipservice"
        provider: "fabric8"
        group: "com.redhat.demo"
    template:
      metadata:
        annotations:
          fabric8.io/iconUrl: "img/icons/spring-boot.svg"
          fabric8.io/metrics-path: "dashboard/file/kubernetes-pods.json/?var-project=ipservice&amp;var-version=1.0.0-SNAPSHOT"
        labels:
          provider: "fabric8"
          project: "ipservice"
          version: "1.0.0-SNAPSHOT"
          group: "com.redhat.demo"
      spec:
        containers:
        - env:
          - name: "KUBERNETES_NAMESPACE"
            valueFrom:
              fieldRef:
                fieldPath: "metadata.namespace"
          image: "demo/ipservice:latest"
          imagePullPolicy: "IfNotPresent"
          livenessProbe:
            httpGet:
              path: "/health"
              port: 8080
            initialDelaySeconds: 180
          name: "spring-boot"
          ports:
          - containerPort: 8080
            protocol: "TCP"
          - containerPort: 9779
            protocol: "TCP"
          - containerPort: 8778
            protocol: "TCP"
          readinessProbe:
            httpGet:
              path: "/health"
              port: 8080
            initialDelaySeconds: 10
          securityContext:
            privileged: false</code></pre>
</div>
</div>
<div class="paragraph">
<p>Wow! It built out a Kubernetes Service and Kubernetes Deployment resource file/manifest for us! We didn&#8217;t have to touch a single line of yaml/json!</p>
</div>
<div class="paragraph">
<p>Let&#8217;s run our application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>$ mvn fabric8:run

...

[INFO] F8:
[INFO] F8:   .   ____          _            __ _ _
[INFO] F8:  /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
[INFO] F8: ( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
[INFO] F8:  \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
[INFO] F8:   '  |____| .__|_| |_|_| |_\__, | / / / /
[INFO] F8:  =========|_|==============|___/=/_/_/_/
[INFO] F8:  :: Spring Boot ::        (v1.3.7.RELEASE)
[INFO] F8:
[INFO] F8: 2016-10-13 15:28:25.036  INFO 1 --- [           main] b.c.PropertySourceBootstrapConfiguration : Located property source: ConfigMapPropertySource [name='c
onfigmap.helloservice.demos']
[INFO] F8: 2016-10-13 15:28:25.107  INFO 1 --- [           main] com.example.SimpleHelloWorldApplication  : The following profiles are active: kubernetes
[INFO] F8: 2016-10-13 15:28:25.130  INFO 1 --- [           main] ationConfigEmbeddedWebApplicationContext : Refreshing org.springframework.boot.context.embedded.Anno
tationConfigEmbeddedWebApplicationContext@76a3e297: startup date [Thu Oct 13 15:28:25 UTC 2016]; parent: org.springframework.context.annotation.AnnotationConfigAppli
cationContext@3d8c7aca
[INFO] F8: 2016-10-13 15:28:26.438  WARN 1 --- [           main] o.s.c.a.ConfigurationClassPostProcessor  : Cannot enhance @Configuration bean definition 'refreshSco
pe' since its singleton instance has been created too early. The typical cause is a non-static @Bean method with a BeanDefinitionRegistryPostProcessor return type: C
onsider declaring such methods as 'static'.
[INFO] F8: 2016-10-13 15:28:26.650  INFO 1 --- [           main] o.s.cloud.context.scope.GenericScope     : BeanFactory id=42012acd-ba39-3d3f-a192-f858c774cda3
[INFO] F8: 2016-10-13 15:28:26.728  INFO 1 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'org.springframework.cloud.autoconfigure.Configurati
onPropertiesRebinderAutoConfiguration' of type [class org.springframework.cloud.autoconfigure.ConfigurationPropertiesRebinderAutoConfiguration$$EnhancerBySpringCGLIB
$$384e865e] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
[INFO] F8: 2016-10-13 15:28:26.738  INFO 1 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean 'org.springframework.cloud.autoconfigure.RefreshEndp
ointAutoConfiguration' of type [class org.springframework.cloud.autoconfigure.RefreshEndpointAutoConfiguration$$EnhancerBySpringCGLIB$$e1ad8854] is not eligible for
getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
[INFO] F8: 2016-10-13 15:28:27.227  INFO 1 --- [           main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat initialized with port(s): 8080 (http)
[INFO] F8: 2016-10-13 15:28:27.244  INFO 1 --- [           main] o.apache.catalina.core.StandardService   : Starting service Tomcat
[INFO] F8: 2016-10-13 15:28:27.246  INFO 1 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet Engine: Apache Tomcat/8.0.36</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now if we take a look at the deployments/replicasets/pods, we should see our application has been deployed!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>$ kubectl get pod
NAME                READY     STATUS    RESTARTS   AGE
ipservice-1-v3hjc   1/1       Running   0          1m</code></pre>
</div>
</div>
<div class="paragraph">
<p>Have a look at the <a href="http://maven.fabric8.io">Fabric8 Maven Plugin</a> docs to see how to live-reload, debug, import directly to CI/CD, start/stop/undeploy etc your Spring Boot app.</p>
</div>
</div>
<div class="sect2">
<h3 id="openshif-s2i-binary-builds">2.5. OpenShif s2i binary builds</h3>
<div class="paragraph">
<p>What if we wanted to use OpenShift to build the Docker image? What if we weren&#8217;t able to install a Docker daemon locally and wanted to use OpenShift to do the docker builds? Easy! Just change the mode from (default: <code>kubernetes</code>) to <code>openshift</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>$ mvn clean install -Dfabric8.mode=openshift</code></pre>
</div>
</div>
<div class="paragraph">
<p>Doing this will create an OpenShift BuildConfig and kick off a binary s2i build!</p>
</div>
<div class="paragraph">
<p>Then if we want to do a deploy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>mvn fabric8:deploy -Dfabric8.mode=openshift</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the maven plugin will create the appropriate OpenShift DeploymentConfig and use the associated OpenShift ImageStreams that were created from the BuildConfig.</p>
</div>
<div class="paragraph">
<p>This approach is great when you don&#8217;t have access to a Docker daemon to kick off docker builds. Just let the OpenShift Container Platform do it for you.</p>
</div>
</div>
<div class="sect2">
<h3 id="continuous-delivery">2.6. Continuous Delivery</h3>
<div class="paragraph">
<p>We want to continuously deliver Spring Boot microservices!</p>
</div>
<div class="paragraph">
<p>Creating a project as we did above is okay to get started. A lot of times we create projects and then for each one have to go through the steps of setting up a git repository, setting up builds in some kind of CI system, and then fabricating a deployment pipeline that suits us. Then we have to connect all those pieces together. If we want to use containers and run them in Kubernetes then we have to go try find all of the plugins and configure them (and understand the nuance of each). What if we could just do all of this with a couple clicks?</p>
</div>
<div class="paragraph">
<p>The Fabric8 console allows us to do this. It is a webconsole for Kubernetes that has lots of goodies not the least of which is built-in CI/CD with Jenkins Pipelines. To get started creating a Spring Boot microservice and attach it to a CI/CD system, log in to the console and choose a team (default team works fine for illustration)</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/f8-choose-team.png" alt="f8 choose team"></span></p>
</div>
<div class="paragraph">
<p>Next we want to create an application, so click Create Application:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/f8-create-app.png" alt="f8 choose team"></span></p>
</div>
<div class="paragraph">
<p>If we had created our app using any of the above (Spring Initializr/STS, JBDS, or IntelliJ) we can check our code into git and import the project. But here, we&#8217;re going to create a new app:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/f8-new-app.png" alt="f8 choose team"></span></p>
</div>
<div class="paragraph">
<p>In this next dialog, we have myriad of options to choose for how we want to create our microservice. Let&#8217;s choose the Spring Boot option (but Go, Integration, and WildFly Swarm are also great options!):</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/f8-choose-spring-boot.png" alt="f8 choose spring boot"></span></p>
</div>
<div class="paragraph">
<p>Give it a name/package name and click "Next"</p>
</div>
<div class="paragraph">
<p>Now you can see a dialog that looks similar to the <a href="http://start.spring.io">http://start.spring.io</a> page that lets you choose which version of Spring Boot you want to use and which dependencies to add:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/f8-sb-select-deps.png" alt="f8 select boot deps"></span>
<span class="image"><img src="images/f8-sb-deps.png" alt="f8 select boot deps"></span></p>
</div>
<div class="paragraph">
<p>Once you&#8217;ve selected the dependencies you like, click "Next"</p>
</div>
<div class="paragraph">
<p>Now you&#8217;re taken to a dialog that asks us to select a CI/CD pipeline to associate with your project (eg, CanaryReleaseStageAndApprove for a pipeline with rolling upgrades between environments and approval steps). Choose a pipeline.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/f8-ci-cd.png" alt="f8 choose team"></span></p>
</div>
<div class="paragraph">
<p>After selecting a pipeline, click "Next" and wait a moment for your project to be completed and everything to be set up.
You&#8217;ll initially be taken to a dashboard that appears mostly empty. Give it a few minutes to come alive.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/f8-init-env.png" alt="f8 choose team"></span></p>
</div>
<div class="paragraph">
<p>In the mean time, you can navigate to the internal git repository that comes out of the box with a fabric8 installation:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/f8-navigate-gogs.png" alt="f8 choose team"></span></p>
</div>
<div class="paragraph">
<p>Sign in to Gogs to see the repo (note default password for the default installation of fabric8 is <code>gogsadmin/RedHat$1</code>):</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/f8-sign-in-gogs.png" alt="f8 login gogs"></span></p>
</div>
<div class="paragraph">
<p>Once you&#8217;ve logged into the Git repo, you can navigate to find your project, and clone it to your IDE and start working where you wish.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/f8-gogs-foo.png" alt="f8 login gogs"></span></p>
</div>
<div class="paragraph">
<p>If you go back to the console after the builds take place, you should see that your new project has been automatically attached to the Fabric8 CI/CD system:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/f8-success-ci-cd.png" alt="f8 login gogs"></span></p>
</div>
<div class="paragraph">
<p>Your new Spring Boot app was checked into git, a new Jenkins Pipeline continuous delivery pipeline was set up, all builds are integrated with Nexus and the Docker registry and you&#8217;ve even deployed into the Staging environment. Take a browse around the Dashboard to get more familiar. The current build is waiting in an "approval" state before it can get to production. In the Build log console you should be able to see the button to "Approve" the build or "Deny" it. Additionally, if we had deployed the chat applications (LetsChat/HipChat/Slack,etc) then we could have approved/denied this build via ChatOps. Or, we could have hooked it up to a ticketing system. Or, if you like crusty old email, we could have done it like that as well.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="create-microservice-via-console">3. Create a microservice via the console</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The easiest way to configure the Pipeline for your project is via the <a href="http://fabric8.io/guide/console.html">fabric8 developer console</a>.</p>
</div>
<div class="paragraph">
<p>When you open the fabric8 console you should see a screen like this:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/console-home.png" alt="fabric8 developer console: Start page"></span></p>
</div>
<div class="paragraph">
<p>A <code>Team</code> is a kubernetes namespace running your development tools (like Jenkins, Nexus, JBoss Forge) and is associated with a number of environments (Testing, Staging, Production etc).</p>
</div>
<div class="paragraph">
<p>Click on the <code>Team Dashboard</code> which should take you to the Team Dashboard where you can create new apps or view your existing apps:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/console-dashboard.png" alt="fabric8 developer console: Team Dashboard"></span></p>
</div>
<div class="paragraph">
<p>If you click the <code>Create Application</code> you get to the create wizard page:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/create-project.png" alt="fabric8 developer console: Create App"></span></p>
</div>
<div class="paragraph">
<p>Then you get to pick what kind of project you wish to create and its name:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/create-app.png" alt="fabric8 developer console: Select Project Type"></span></p>
</div>
<div class="paragraph">
<p>Then choose your <a href="cdelivery.html">CD Pipeline</a>:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/console-pick-pipeline.png" alt="fabric8 developer console: Choose CD Pipeline"></span></p>
</div>
<div class="paragraph">
<p>If you choose <code>Copy pipeline to project</code> then the Jenkinsfile that defines the pipeline gets copied into your project&#8217;s git repository so that you can easily edit it later on via a versioned source code change just like any other code change.</p>
</div>
<div class="paragraph">
<p>Now you will be taken to the <code>App Dashboard</code> where you can see all the environments and active pipelines along with recent commits on a single pane of glass. This is how it looks once the Canary release, Testing and Staging is complete; waiting for Promotion to Production</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/console-app-dashboard.png" alt="fabric8 developer console: App Dashboard"></span></p>
</div>
<div class="paragraph">
<p>You can click on the <code>Proceed</code> button to promote to Production, or <code>Abort</code> to stop the pipeline.</p>
</div>
<div class="paragraph">
<p>You can easily switch between all your development tools (Gogs, Jenkins, Nexus etc) using the tool drop down menu at the top right of the screen:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/console-tools.png" alt="Clicking on the tools drop down to see development apps"></span></p>
</div>
<div class="sect3">
<h4 id="runtime-tabs">3.1. Runtime tabs</h4>
<div class="paragraph">
<p>The <code>Team</code> page has a <code>Runtime</code> tab that lets you browse the runtime of your development environment. Or from the home page you can click on an environment page to view its runtime.</p>
</div>
<div class="paragraph">
<p>The <code>Runtime</code> pages have a number of tabs that let you work with the various Kubernetes resources. We&#8217;ll highlight the main ones you&#8217;ll need to use:</p>
</div>
<div class="sect4">
<h5 id="replicas">Replicas</h5>
<div class="paragraph">
<p>The main tab to get a feel for what&#8217;s running in your system is the <strong>Replicas</strong> tab which shows all the <a href="replicationControllers.html">replication controllers</a> or ReplicaSets on Kubernetes.</p>
</div>
<div class="paragraph">
<p>To scale up or down a controller to run more or less <a href="pods.html">pods</a> (containers) just increase or decrease the <strong>Desired Replicas</strong> value and hit <strong>Save</strong> and hey presto pods are created or destroyed.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/controllers.png" alt="controllers tab screenshot"></span></p>
</div>
</div>
<div class="sect4">
<h5 id="overview">Overview</h5>
<div class="paragraph">
<p>The <strong>Overview</strong> tab gives you a feel for how all the various <a href="services.html">services</a> and <a href="replicationControllers.html">replication controllers</a> interact:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/overview.png" alt="overview tab screenshot"></span></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="demo">3.2. Demo</h4>
<div class="paragraph">
<p>Here is a <a href="https://vimeo.com/170830750">video demonstrating how to create a microservice and then deploy and edit it via Continuous Delivery</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="elasticity">4. Elasticity and Resilience</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Your Microservices should be <strong>highly available</strong> and resilient to failure. Ideally each Microservice should also be <em>elastic</em> so that you can easily scale up or down the number of containers used for each Microservice. Some Microservices may only require one container; others may require many.</p>
</div>
<div class="paragraph">
<p>Many times when considering elasticity, you have to consider whether your app is stateless or stateful. Stateless apps should be trivial to scale up and down, however stateful apps require more care. For example, a stateful data store would need to shard and replicate its state across the members in the cluster and know how to rebalance itself during scaling events.</p>
</div>
<div class="paragraph">
<p>Fabric8 solves these elasticity and resilience problems by using Kubernetes <a href="../replicationControllers.html">Replica Sets</a> (which used to be called Replication Controllers). Just like most configurations for Kubernetes, a Replica Set is a way to reconcile a desired state: you tell Kubernetes what state the system should be and Kubernetes figures out how to make it so. A Replica Set controls the number of <code>replicas</code> or exact copies of the app that should be running at any time.</p>
</div>
<div class="paragraph">
<p>A <em>Replia Set</em> defines a template for running on or more <a href="../pods.html">pods</a> which then can be scaled either by an operator or automatically by Kubernetes based on some system high watermarks.</p>
</div>
<div class="paragraph">
<p>The Replica Set uses a <em>selector</em> to keep watching the available pods matching the selectors labels. If there are not enough pods running it will spin up more; or if there are too many pods running it will terminate the extra pods.</p>
</div>
<div class="sect2">
<h3 id="operator-based-scaling">4.1. Operator-based scaling</h3>
<div class="paragraph">
<p>To scale your Replica Set you just need to specify how many <code>replicas</code> you wish by default in your Replica Set YAML file. The default value of 1 should ensure that there is always a pod running. If a pod terminates (or the host running the pod terminates) then Kubernetes will automatically spin up another pod for you.</p>
</div>
</div>
<div class="sect2">
<h3 id="autoscaling">4.2. Autoscaling</h3>
<div class="paragraph">
<p>To autoscale you need to annotate your Replica Set with the metadata required, such as CPU limits or custom metrics so that Kubernetes knows when to scale up or down the number of pods. Then you can create a <a href="http://kubernetes.io/docs/user-guide/horizontal-pod-autoscaling/">HorizontalPodAutoscaler</a> to let Kubernetes know certain pods/ReplicaSets should participate in autoscaling.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="service-discovery">5. Service Discovery</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="../services.html">Services</a> are implemented by one or more <a href="../pods.html">pods</a> for <a href="highAvailability.html">Elasticity and Resilience</a>. In the cloud <a href="../pods.html">pods</a> can come and go when there are hardware failures or when pods get rescheduled onto different nodes to improve resource utilisation.</p>
</div>
<div class="paragraph">
<p>To use a service you need to dynamically discover the pods implementing the service so that you can invoke it. This is called <em>service discovery</em>.</p>
</div>
<div class="sect2">
<h3 id="kubernetes-service-discovery">5.1. Kubernetes Service Discovery</h3>
<div class="paragraph">
<p>The default way to discover the pods for a <a href="../services.html">kubernetes service</a> is via DNS names.</p>
</div>
<div class="sect3">
<h4 id="service-discovery-via-dns">5.1.1. Service discovery via DNS</h4>
<div class="paragraph">
<p>For a service named <code>foo-bar</code> you can just hard code the host name <code>foo-bar</code> in your application code.</p>
</div>
<div class="paragraph">
<p>e.g. to access a HTTP URL use <code><a href="http://foo-bar/" class="bare">http://foo-bar/</a></code> or for HTTPS use <code><a href="https://foo-bar/" class="bare">https://foo-bar/</a></code> (assuming the service is using the port 80 or 443 respectively).</p>
</div>
<div class="paragraph">
<p>If you use a non standard port number, say, 1234, then append that port number to your URL such as <code><a href="http://foo-bar:1234/" class="bare">http://foo-bar:1234/</a></code>.</p>
</div>
<div class="paragraph">
<p>Note that DNS works in kubernetes by resolving to the service named <code>foo-bar</code> in the namespace of your pods so you don&#8217;t have to worry about configuring your application with environment specific configuration or worry about accidentally talking to the production service when in a testing environment! You can then move your application (its docker image and kubernetes metadata) into any environment and your application works without any changes!</p>
</div>
</div>
<div class="sect3">
<h4 id="service-discovery-via-environment-variables">5.1.2. Service discovery via environment variables</h4>
<div class="paragraph">
<p>Kubernetes uses 2 environment variables to expose the fixed IP address and port that you can use to access the service.</p>
</div>
<div class="paragraph">
<p>So for a service named <code>foo-bar</code> you can use these 2 environment variables to access the service:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>FOO_BAR_SERVICE_HOST</code> is the host (IP) address of the service</p>
</li>
<li>
<p><code>FOO_BAR_SERVICE_PORT</code> is the port of the service</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>e.g. you could access a web site or service via:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://${FOO_BAR_SERVICE_HOST}:${FOO_BAR_SERVICE_PORT}/</code></pre>
</div>
</div>
<div class="paragraph">
<p>The value of the host and port are fixed for the lifetime of the service; so you can just resolve the environment variables on startup and you&#8217;re all set!</p>
</div>
<div class="paragraph">
<p>Under the covers Kubernetes will load balance over all the service endpoints for you.</p>
</div>
<div class="paragraph">
<p>Note a <a href="pod.html">pod</a> can terminate at any time; so its recommended that any network code should retry requests if a socket fails; then kubernetes will failover to a pod for you.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-ribbon">5.1.3. Using Ribbon</h4>
<div class="paragraph">
<p>If you are using Java to implement your Microservice then you can use Ribbon from NetflixOSS to perform process local load balancing over the available endpoints.</p>
</div>
<div class="paragraph">
<p>We recommend using Kubernetes Service Discovery via DNS (see above) by default because:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it works for services using any network protocols based on TCP and UDP</p>
</li>
<li>
<p>it works for any Microservice language implementation</p>
</li>
<li>
<p>apart from a String change, it typically has minimal impact on the code of your Microservice.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However using Ribbon means that your Java code has an in memory model of the available endpoints you could invoke; which lets you plugin your own custom load balancing logic into your Microservice.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="load-balancing">6. Load Balancing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you have one or more pods implementing a <a href="../services.html">service</a> then you need to load balance requests across them.</p>
</div>
<div class="paragraph">
<p>When your Microservice is running inside Kubernetes then the <a href="serviceDiscovery.html">service discovery</a> automatically takes care of load balancing across the available pods for you.</p>
</div>
<div class="paragraph">
<p>However if your Microservice exposes a web application or API which is intended to be used by users or Microservices hosted outside of the Kubenretes cluster, then you need to expose your Microservice to an external host endpoint.</p>
</div>
<div class="paragraph">
<p>To expose your Microservice you need to create an <code>Ingress</code> resource in Kubernetes which will then implement the external load balancer for you.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="design-for-failure">7. Design for failure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Traditionally we&#8217;ve tried to "avoid" failure by doing whatever we could to make services/components "not fail". We would deploy monolithic "appliances" (hardware or software) and if that appliance failed it was a significant event. As we start to move toward distributed systems, especially Microservices, we find that there are many more points of failure. Microservices are implemented as a collection of services that evolve independently and interact and react to their surrounding environments including the changing of user/customer behaviors, business strategy/direction, system behavior, and even other services. One premise of these types of complex-adaptive systems is the ability to withstand failures and unexpected faults.</p>
</div>
<div class="paragraph">
<p>To do this, you must design your services with failure in mind. There are a handful of practices that come to mind:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>maximize service availability</p>
</li>
<li>
<p>self healing</p>
</li>
<li>
<p>isolate the "blast radius" of any single failure</p>
</li>
<li>
<p>continually prove your system has been designed for failure</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="maximize-service-availability">7.1. Maximize service availability</h4>
<div class="paragraph">
<p>We know services individually can fail or be removed from a cluster for any number of reasons. We&#8217;d like for clients to have many options for connecting to a service so we run many <code>replicas</code> of them as described in <a href="elasticity.md">Elasticity and Resilience</a>. When services fail, or are removed from the cluster, we also want to maximize the ability to failover from a client perspective. For this we rely on <a href="serviceDiscovery.md">Service Discovery</a>. With both of those concepts in place we can simply rely on the infrastructure to maximize the availability of our services.</p>
</div>
</div>
<div class="sect3">
<h4 id="self-healing">7.2. Self healing</h4>
<div class="paragraph">
<p>Another critical pattern of a Microservices environment is to enable self healing. If services fail, do we need manual intervention? Ideally the system would be able to identify faults and correct them. The simplest way to correct a faulty service is to just kill it and restart. Kubernetes provides this type of ability for us with <a href="http://kubernetes.io/docs/user-guide/liveness/">Liveness and Health checks</a>. When liveness or health checks run, and they find that a system is not in a healthy state, the service will be killed. Combined with <a href="../replicationControllers.html">ReplicaSets</a>, Kubernetes will restore the service to maintain the desired number of <code>replicas</code> Fabric8 <a href="../mavenFabric8Json.md">has tooling</a> for <a href="../forge.md">enabling liveness and health checks by default</a> when we deploy our services.</p>
</div>
</div>
<div class="sect3">
<h4 id="isolate-blast-radius-of-failures">7.3. Isolate blast radius of failures</h4>
<div class="paragraph">
<p>When services on which we depend (other Microservices, databases, message queues, caches, etc) start experiencing faults we need to be able to limit the extent of that damage so it doesn&#8217;t cause cascading failures. The first step for doing this starts at the application level. Tools like <a href="https://github.com/Netflix/Hystrix">Netflix Hystrix</a> provide <a href="http://skife.org/architecture/fault-tolerance/2009/12/31/bulkheads.html">bulkheading</a> and within Fabric8 we can use <a href="https://github.com/fabric8io/kubeflix">kubeflix project</a>. Hystrix within the Kubeflix project allows us to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>limit the number of callers affected by this failure</p>
</li>
<li>
<p>shed load with <a href="circuitBreakers.md">circuit breakers</a></p>
</li>
<li>
<p>limit the number of calls to a predefined set of threads that can withstand failures</p>
</li>
<li>
<p>put a cap on how long a caller can assume the service is still working (timeouts on service calls). without these limits, latency can make calls think the service is still functioning fine and continue sending traffic potentially further overwhelming the service.</p>
</li>
<li>
<p>visualize this in a dynamic environment where services will be coming and down, potentially alleviating or amplifying faults</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>From the domain perspective, we have to be able to degrade gracefully when these downstream components are faulting. We can limit the blast radius of a faulting component, but if we provide a service, how do we maintain our promise to deliver that service? Hystrix also allows us to use fallback methods and workflows to provide some level of (possibly degraded) service even in the event of failures.</p>
</div>
</div>
<div class="sect3">
<h4 id="prove-your-system-has-been-designed-for-failure">7.4. Prove your system has been designed for failure</h4>
<div class="paragraph">
<p>When you&#8217;ve designed your system with failure in mind and able to withstand faults, a useful technique is to continuously prove whether or not this is true. With fabric8, we have an out of the box <a href="../chaosMonkey.md">chaos monkey</a> that can go through your Kubernetes namespaces and randomly kill pods in any of your environments including production. If you&#8217;ve not designed your services to be able to withstand these types of faults, then you want to know with fast feedback. Chaos monkey can provide that feedback.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration">8. Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As developers we usually try to make the software we create easy to configure so that it can be used in any environment.</p>
</div>
<div class="paragraph">
<p>However building Microservices on the cloud changes our approach to configuration since you no longer need to configure the following differently for each environment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>file locations: since docker images have the same file system layout whatever the environment</p>
</li>
<li>
<p>service locations: instead use <a href="serviceDiscovery.html">service discovery</a></p>
</li>
<li>
<p>secrets like usernames and passwords: instead use <a href="http://kubernetes.io/docs/user-guide/secrets/">kubernetes secrets</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So it turns out that many Microservices no longer need any configuration values which change for different environments thanks to the above!</p>
</div>
<div class="paragraph">
<p>This helps reduce possible errors; it means most configuration for your Microservice can be included inside the docker image and tested in every environment in your <a href="http://fabric8.io/guide/cdelivery.html">CI / CD Pipeline</a></p>
</div>
<div class="paragraph">
<p>However for times when you really need to configure things differently on a per environment/deployment basis then here are the main approaches:</p>
</div>
<div class="sect3">
<h4 id="include-configuration-inside-the-docker-image">8.1. Include configuration inside the docker image</h4>
<div class="paragraph">
<p>The simplest thing to do with configuration is just include it inside your docker image. e.g. if you are building a Spring Boot Microservice then just include the <code>application.properties</code> or <code>application.yml</code> file inside your <code>src/main/resources</code> folder so that it gets included into your jar and the docker image. This then means that all your configuration gets tested as part of your <a href="http://fabric8.io/guide/cdelivery.html">CI / CD Pipeline</a></p>
</div>
<div class="paragraph">
<p>This assumes the configuration will be the same in each environment due to the above (using <a href="serviceDiscovery.html">service discovery</a> and <a href="http://kubernetes.io/docs/user-guide/secrets/">kubernetes secrets</a>).</p>
</div>
<div class="paragraph">
<p>For any environment specific values then you could specify environment variables in your kubernetes resource. e.g. your <a href="http://kubernetes.io/docs/user-guide/deployments/">Kubernetes Deployments</a> can include <code>env</code> values in the pod template&#8217;s container section.</p>
</div>
<div class="paragraph">
<p>Though its good practice maximise the amount of immutable arfefacts you have (e.g. docker images and kubernetes resources) and to minimise the amount of artifacts you need to modify for each environment. So for per-environment configuration we recommend one of the following approaches:</p>
</div>
</div>
<div class="sect3">
<h4 id="configmap">8.2. ConfigMap</h4>
<div class="paragraph">
<p>Kubernetes supports a resource called <a href="http://kubernetes.io/docs/user-guide/configmap/">ConfigMap</a> which is used to store <strong>environment specific</strong> configuration values - all other configuration values should be inside the docker image as described above.</p>
</div>
<div class="paragraph">
<p>You can then expose the <code>ConfigMap</code> resources either as volume mounts or as environment variables.</p>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/fabric8-quickstarts/spring-boot-webmvc">spring-boot-webmvc quickstart</a> uses a <a href="https://github.com/fabric8-quickstarts/spring-boot-webmvc/blob/master/src/main/fabric8/configmap.yml#L4">ConfigMap to store the application.properties file</a> which is then mounted into each Pod via the <a href="https://github.com/fabric8-quickstarts/spring-boot-webmvc/blob/master/src/main/fabric8/deployment.yml#L5-L15">deployment.yml</a>. Then Spring Boot will load the <code>application.properties</code> entry from this ConfigMap on startup!</p>
</div>
<div class="paragraph">
<p>Another approach if you are using Spring is the <a href="https://github.com/fabric8io/spring-cloud-kubernetes#configmap-propertysource">ConfigMap based PropertySource</a> which loads environment specific configurations from a ConfigMap.</p>
</div>
<div class="paragraph">
<p>Both these approaches have a similar effect; the former reuses kubernetes manifest to wire things up; the latter uses a new maven dependency and Java code to achieve a similar effect.</p>
</div>
</div>
<div class="sect3">
<h4 id="git">8.3. Git</h4>
<div class="paragraph">
<p>One of the downsides of using <code>ConfigMap</code> as described above is that there&#8217;s no history or change tracking; there&#8217;s just the latest version of the ConfigMap. For complex configuration its very useful to have a changelog so you can see who changed what configuration values when so that when things start to go wrong you can easily revert changes or see the history.</p>
</div>
<div class="paragraph">
<p>So you can store your environment specific configuration in a git repository (maybe using a different branch or repo for each environment) then you can mount the git repository as a volume in your Microservice docker container via a <a href="http://kubernetes.io/docs/user-guide/volumes/#gitrepo"><code>gitRepo</code> volume</a> using a specific git revision.</p>
</div>
<div class="paragraph">
<p>You can then use the <a href="https://github.com/fabric8io/gitcontroller">gitcontroller</a> Microservice to watch the <a href="http://kubernetes.io/docs/user-guide/deployments/">Kubernetes Deployments</a> with one or more <a href="http://kubernetes.io/docs/user-guide/volumes/#gitrepo"><code>gitRepo</code> volumes</a> and it then watches for changes in the associated git repositories and branches.</p>
</div>
<div class="paragraph">
<p>When there are changes in a configuration git repository the <code>gitcontroller</code> will perform a rolling upgrade of the <a href="http://kubernetes.io/docs/user-guide/deployments/">Kubernetes Deployments</a> to use the new configuration git revision; or rollback. The rolling upgrade policy (e.g. speed and number of concurrent pods which update and so forth) is all specified by your <a href="http://kubernetes.io/docs/user-guide/deployments/#rolling-update-deployment">rolling update configuration in the Deployment specification</a>.</p>
</div>
<div class="paragraph">
<p>Here is an <a href="https://github.com/jstrachan/springboot-config-demo/blob/master/src/main/fabric8/deployment.yml#L5-L14">example of how to add a <code>gitRepo</code> volume to your application</a>; in this case a spring boot application to load the <a href="https://github.com/jstrachan/sample-springboot-config/blob/master/application.properties"><code>application.properties</code></a> file from a git repository.</p>
</div>
<div class="paragraph">
<p>You can either run <code>gitcontroller</code> as a Microservice in your namespace or you can use the <code>gitcontroller</code> binary at any time or as part of your <a href="http://fabric8.io/guide/cdelivery.html">CI / CD Pipeline</a> process.</p>
</div>
</div>
<div class="sect3">
<h4 id="choosing-the-right-approach">8.4. Choosing the right approach</h4>
<div class="paragraph">
<p>We recommend you try to keep the environment specific configuration down to a minimum as that increases the amount of resuable immuable artifacts (docker images and kubernetes resources) that can be used without modification in any environment and promotes confidence and testing of those artifacts across your <a href="http://fabric8.io/guide/cdelivery.html">CI / CD Pipeline</a>.</p>
</div>
<div class="paragraph">
<p>So if you can avoid any configuration that is environment specific (thanks to <a href="serviceDiscovery.html">service discovery</a> and <a href="http://kubernetes.io/docs/user-guide/secrets/">kubernetes secrets</a>) then just including configuration inside your docker image makes the most sense.</p>
</div>
<div class="paragraph">
<p>When you absolutely must have some environment specific configuration which doesn&#8217;t relate to <a href="serviceDiscovery.html">service discovery</a> or <a href="http://kubernetes.io/docs/user-guide/secrets/">secrets</a> then our recommendation is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if you want history and to be able to see who changes what and when so you can easily audit or revert changes then use <code>git</code> and a <a href="http://kubernetes.io/docs/user-guide/volumes/#gitrepo"><code>gitRepo</code> volume</a> to mount the configuration into your docker container. Otherwise use <code>ConfigMap</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pipelines">9. Pipelines</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To go faster developing Microservices its great to automate everything and have a <em>Continuous Deployment pipeline</em> for each Microservice. The pipeline then defines how to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>build your Microservice and create an immutable docker image for it with a unique version label</p>
</li>
<li>
<p>generate or enrich the versioned Kubernetes manifest for your Microservice</p>
</li>
<li>
<p>run <a href="../testing.html">system and integration tests</a> on your image to check its working correctly</p>
</li>
<li>
<p>deploy your Microservice to an environment</p>
</li>
<li>
<p>on approval deploy to the production environment</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In <strong>fabric8</strong> we use <a href="https://jenkins.io/">Jenkins Pipelines</a> to implement the pipeline for each Microservice. The pipeline is defined in a file called <code>Jenkinsfile</code> which is checked into the source repository of each Microservice so that its versioned along with the implementation code.</p>
</div>
<div class="paragraph">
<p>To get started with your first pipeline, just create a new Microservice using the <a href="console.html">Developer Console</a> which will prompt you to pick a suitable
pipeline from the <a href="../jenkinsWorkflowLibrary.html">Reusable Pipeline Library</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="logging">10. Logging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Logging is a key part of being able to understand Microservices and diagnose issues. Consolidating log statements and events and being able to query and visualise them is an extremely useful tool.</p>
</div>
<div class="paragraph">
<p>When running the Fabric8 Microservices Platform we recommend running the <a href="../logging.html">Logging Microservices</a> which runs <a href="http://www.elasticsearch.com/products/elasticsearch/">Elasticsearch</a> for the back end storage and <a href="http://www.elasticsearch.com/products/kibana/">Kibana</a> as the front end and fluentd as the collector.</p>
</div>
<div class="paragraph">
<p>As a Microservice developer, you get <em>logging as a service</em> for free with the <a href="../logging.html">Logging Microservices</a>, though its recommended that you:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>write logs to standard output rather than to files on disk</p>
</li>
<li>
<p>ideally use JSON output so thats its easy to automically parse it</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="monitoring">11. Monitoring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Capturing historical metrics is essential to diagnose issues involving your Microservices. Its also very useful for <a href="elasticity.html">auto scaling</a></p>
</div>
<div class="paragraph">
<p>So we recommend running the <a href="../metrics.html">Metrics Microservice</a> which uses * <a href="http://prometheus.io/">Prometheus</a> as the back end storage service and REST API and then <a href="http://grafana.org/">Grafana</a> as the console to view, query and analyze metrics.</p>
</div>
<div class="paragraph">
<p>If you use Java then using a <a href="https://github.com/prometheus/jmx_exporter">JMX Exporter YAML file</a> will configure which JMX metrics to export to Prometheus.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="circuit-breakers">12. Circuit Breakers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Adding circuit breakers via the <a href="https://github.com/Netflix/Hystrix">Hystrix</a> library helps you fail fast or provide a fallback if any dependent service either goes down or goes too slow.</p>
</div>
<div class="paragraph">
<p>Hystrix is a library rather than anything else, which means that it can just be easily added in <strong>any</strong> java program. Additionally there are frameworks that provide integration with Hystrix:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#kubeflix">Kubeflix</a></p>
</li>
<li>
<p><a href="#wildfly-swarm-netflix">Wildfly Swarm - Netflix</a>
*</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="a-href-spring-cloud-netflix-spring-cloud-netflix-a">12.1. <a href="#spring-cloud-netflix">Spring Cloud - Netflix</a></h3>

</div>
<div class="sect2">
<h3 id="standalone-applications">12.2. Standalone applications</h3>
<div class="paragraph">
<p>Using Hystrix is as simple as implementing the <a href="https://github.com/Netflix/Hystrix/blob/master/hystrix-core/src/main/java/com/netflix/hystrix/HystrixCommand.java">HystrixCommand</a> interface.
Borrowed from <a href="https://github.com/Netflix/Hystrix/tree/master/hystrix-examples">hystrix examples</a> here is a simple <em>Hello World</em> implementation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>public class CommandHelloWorld extends HystrixCommand&lt;String&gt; {

    private final String name;

    public CommandHelloWorld(String name) {
        super(HystrixCommandGroupKey.Factory.asKey("ExampleGroup"));
        this.name = name;
    }

    @Override
    protected String run() {
        return "Hello " + name + "!";
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command can be now executed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>new CommandHelloWorld().execute();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is enough to implement a circuit breaker.</p>
</div>
<div class="sect3">
<h4 id="exposing-hystrix-metrics">12.2.1. Exposing Hystrix metrics</h4>
<div class="paragraph">
<p>To expose metrics from the circuit breaker one needs to expose the <a href="https://github.com/Netflix/Hystrix/blob/master/hystrix-contrib/hystrix-metrics-event-stream/src/main/java/com/netflix/hystrix/contrib/metrics/eventstream/HystrixMetricsStreamServlet.java">HystrixMetricsStreamServlet</a>, which can be found inside:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        &lt;dependency&gt;
            &lt;groupId&gt;com.netflix.hystrix&lt;/groupId&gt;
            &lt;artifactId&gt;hystrix-metrics-event-stream&lt;/artifactId&gt;
            &lt;version&gt;1.4.9&lt;/version&gt;
        &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To register the servlet one needs to simply add the following inside the web.xml:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    &lt;servlet&gt;
        &lt;display-name&gt;metrics&lt;/display-name&gt;
        &lt;servlet-name&gt;metrics&lt;/servlet-name&gt;
        &lt;servlet-class&gt;com.netflix.hystrix.contrib.metrics.eventstream.HystrixMetricsStreamServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;metrics&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/hystrix.stream&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-the-hystrix-dashboard">12.2.2. Using the Hystrix dashboard</h4>
<div class="paragraph">
<p>An application that is <a href="#exposing-hystrix-metrics">exposing its hystrix metrics stream</a> can take advantage of the visualization capabilities of the <a href="https://github.com/Netflix/Hystrix/tree/master/hystrix-dashboard">Hystrix Dashboard</a>.</p>
</div>
<div class="paragraph">
<p>This is as simple as pointing the dashboard to the url of the hystrix metrics stream.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-turbine-to-aggregate-multiple-hystrix-stream">12.2.3. Using Turbine to aggregate multiple hystrix stream</h4>
<div class="paragraph">
<p>To make the most out of the Hystrix dashboard you can aggregate multiple streams and have the dashboard visualize multiple circuit breakers at once.</p>
</div>
<div class="paragraph">
<p>The aggregation is performed by <a href="https://github.com/Netflix/Turbine/wiki">Turbine</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kubeflix">12.3. Kubeflix</h3>
<div class="paragraph">
<p>Everything that has been mentioned so far is something that can easily used inside simple java application. But if those application are to be run inside Kubernetes, there will be some additional requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#circuit-breaker-discovery">Circuit Breaker discovery</a></p>
</li>
<li>
<p><a href="#turbine-server-docker-image">Turbine Server Docker image</a></p>
</li>
<li>
<p><a href="#hystrix-dashboard-docker-image">Hystrix Dashboard Docker image</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="circuit-breaker-discovery">12.3.1. Circuit Breaker Discovery</h4>
<div class="paragraph">
<p>In most cloud environments ip addresses are not known in advanced and kubernetes is no exception. This means that we can&#8217;t have Turbine pre-configured with a fixed set of urls but instead we need a discovery mechanism.
This mechanism is provided by Kubeflix and it pretty much allows to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Discovery all endpoints in the current that have been labeled as <code>hystrix.enabled</code>.</p>
</li>
<li>
<p>Define multiple clusters that are composed by multiple endpoints accross multiple namespaces.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="turbine-server-docker-image">12.3.2. Turbine Server Docker image</h4>
<div class="paragraph">
<p>Having a discovery implementation for turbine is not enough. We also need a turbine server app packaged as a docker container and of course the required Kubernetes configuration.
Kubeflix provides both (image and configuration).</p>
</div>
<div class="paragraph">
<p>The image is a simple webapp, pre-configured with the <a href="#circuit-breaker-discovery">Circuit Breaker discovery</a> as described above. The great thing about this app is that the default configuration can be modified by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Environment Variables</p>
</li>
<li>
<p>ConfigMap</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>and that makes it easier for the user to define his own clusters or tune turbine to his own needs.</p>
</div>
</div>
<div class="sect3">
<h4 id="hystrix-dashboard-docker-image">12.3.3. Hystrix Dashboard Docker image</h4>
<div class="paragraph">
<p>For the Hystrix dashboard we also need to package it as a Docker container and create the required Kubernetes configuration.
Again Kubeflix provides both. On top of that web console is configured to reference Turbine Servers DNS name <strong>out of the box</strong>.</p>
</div>
<div class="paragraph">
<p>For more details, please visit the <a href="https://github.com/fabric8io/kubeflix">kubeflix project</a>.</p>
</div>
<div class="paragraph">
<p>â€”</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="wildfly-swarm-netflix">12.4. Wildfly Swarm Netflix</h3>
<div class="paragraph">
<p>Taken directly from the <a href="http://wildfly-swarm.io">Wildfly Swarm Website</a>:</p>
</div>
<div class="paragraph">
<p><code>Swarm offers an innovative approach to packaging and running JavaEE applications by packaging them with just enough of the server runtime to &quot;java -jar&quot; your application.</code></p>
</div>
<div class="paragraph">
<p>One of the available modules is <a href="https://github.com/wildfly-swarm/wildfly-swarm-netflix">Wildfly Swarm Netflix</a> which provides integration with the Netflix components.</p>
</div>
<div class="paragraph">
<p>A <strong>Hello World</strong> example of <a href="https://github.com/redhat-helloworld-msa/hola">Hystrix with Wildfly Swarm</a>.</p>
</div>
<div class="paragraph">
<p>It&#8217;s important to note that this example is <code>Kubeflix-ready</code> which means that regardless of how it has been implemented it will be able to integrate with the rest fo the Kubeflix bits. This is also the the case for the next framework in lineâ€¦.</p>
</div>
<div class="paragraph">
<p>â€”</p>
</div>
<div class="sect3">
<h4 id="spring-cloud-netflix">12.4.1. Spring Cloud Netflix</h4>
<div class="paragraph">
<p>This project provides integration between Spring Cloud and the Netflix components, including Hystrix as a <strong>Circuit breaker</strong> implementation.
On top of that it provides integration with <a href="https://github.com/Netflix/ribbon">Ribbon</a> and makes it easy to compose rest application that communicate with each other.</p>
</div>
<div class="paragraph">
<p>For Spring Cloud users it worths mentioning <a href="https://github.com/fabric8io/spring-cloud-kubernetes">Spring Cloud Kubernetes</a> that provides Kubernetes integration with Spring cloud and it allows you to use everything together (Spring Cloud, Kubernetes, Netflix components).</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tracing">13. Tracing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One of the biggest challenges of Microservices is comprehending whats really happening at runtime. Certainly <a href="logging.html">logging</a> and <a href="metrics.html">metrics</a> really help. In addition tracing can really help comprehend how Microservices interact and diagnose performance issues.</p>
</div>
<div class="paragraph">
<p>To get started with tracing in fabric8 <a href="https://blog.fabric8.io/kubernetes-integration-with-zipkin-d6c195dd596d#.nug1hbi2n">check out this blog and vieo</a>.</p>
</div>
<div class="paragraph">
<p>For more details check out the <a href="https://github.com/fabric8io/kubernetes-zipkin">kubernetes zipkin project</a> along with the <a href="http://zipkin.io/">zipkin site</a></p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 3.1.32<br>
Last updated 2016-10-17 08:27:32 UTC
</div>
</div>
</body>
</html>